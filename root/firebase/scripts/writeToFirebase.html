<!-- 
 Can organize info using ai into a json format using the sample bellow.

 Then, uncomment the sample and replace the sample with your json. 

open this on localhost, each time you refresh,
a new event with an unique id will be created. 
  -->

<script type="module">
  // Import required Firebase modules
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
  import {
    getDatabase,
    ref,
    get,
    set,
  } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

  // Firebase setting
  const appSettings = {
    databaseURL:
      "https://wad-proj-2b37f-default-rtdb.asia-southeast1.firebasedatabase.app",
  };

  // Initialize Realtime Database and get a reference to the service
  const app = initializeApp(appSettings);
  const database = getDatabase(app);

  async function getNextEventId() {
    try {
      // Get all current events
      const eventsRef = ref(database, "events/");
      const snapshot = await get(eventsRef);
      const events = snapshot.val();

      if (!events) return "event1";

      // Find the highest event number
      const eventIds = Object.keys(events)
        .filter((key) => key.startsWith("event") && !key.endsWith("Data"))
        .map((key) => parseInt(key.replace("event", "")))
        .filter((num) => !isNaN(num));

      const maxEventId = Math.max(...eventIds);
      return `event${maxEventId + 1}`;
    } catch (error) {
      console.error("Error getting next event ID:", error);
      throw error;
    }
  }

  async function writeEventData(eventData) {
    try {
      // Get next event ID
      const eventId = await getNextEventId();

      // Required fields for events based on the database structure
      const requiredFields = [
        "Admissions Period",
        "Capacity",
        "Description",
        "Location",
        "Organiser",
        "Project Name",
        "Project Requirements",
        "Region",
        "Session(s)",
        "Total CSP hours",
        "Volunteer Period",
      ];

      // Validate that all required fields are present
      for (const field of requiredFields) {
        if (!(field in eventData)) {
          throw new Error(`Missing required field: ${field}`);
        }
      }

      // Write the event data
      await set(ref(database, `events/${eventId}`), eventData);

      return eventId;
    } catch (error) {
      console.error("Error writing event data:", error);
      throw error;
    }
  }

  // // Example usage:
  // const newEventData = {
  //   "Admissions Period": "November 2024 - December 2024 (Sign-ups still open)",
  //   Capacity: "35 volunteers",
  //   Description:
  //     "Work on projects promoting forest restoration and climate resilience. Volunteers will engage with local communities and assist in afforestation efforts, contributing to the global fight against climate change by protecting natural carbon sinks.",
  //   Location: "Green spaces in Singapore",
  //   Organiser: "Conservation International Singapore",
  //   "Project Name": "Natural Climate Solutions",
  //   "Project Requirements":
  //     "Interest in conservation and sustainable practices.",
  //   Region: "Central Singapore",
  //   "Session(s)": "Wednesdays, 8:00 AM - 12:00 PM",
  //   "Total CSP hours": "30 hours",
  //   "Volunteer Period": "February 2025 - April 2025",
  // };
  // writeEventData(newEventData)
  //   .then((eventId) =>
  //     console.log(`Successfully created event with ID: ${eventId}`)
  //   )
  //   .catch((error) => console.error("Error:", error));
</script>
