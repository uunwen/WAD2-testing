<!-- indexadmin.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Event Dashboard</title>
    <script src="https://www.gstatic.com/firebasejs/9.9.3/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.9.3/firebase-firestore.js"></script>
</head>
<body>
    <h1>Admin Dashboard</h1>
    
    <!-- Dropdown for selecting event -->
    <label for="event-dropdown">Select Event:</label>
    <select id="event-dropdown">
        <!-- Events will be populated dynamically -->
    </select>

    <!-- List of students for the selected event -->
    <div id="student-list"></div>

    <script>
        // Firebase config (replace with your Firebase config)
        const firebaseConfig = {
            apiKey: "your-api-key",
            authDomain: "your-auth-domain",
            projectId: "your-project-id",
            storageBucket: "your-storage-bucket",
            messagingSenderId: "your-sender-id",
            appId: "your-app-id"
        };

        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore(app);

        document.addEventListener('DOMContentLoaded', function () {
            const eventDropdown = document.getElementById('event-dropdown');
            const studentListDiv = document.getElementById('student-list');

            // Fetch event data from Firestore (example data structure)
            db.collection('events').get().then(snapshot => {
                snapshot.forEach(doc => {
                    const event = doc.data();
                    const eventId = doc.id;
                    const option = document.createElement('option');
                    option.value = eventId;
                    option.textContent = event.name;
                    eventDropdown.appendChild(option);
                });
            });

            // When an event is selected, load students for that event
            eventDropdown.addEventListener('change', function () {
                const selectedEvent = eventDropdown.value;
                if (selectedEvent) {
                    db.collection('events').doc(selectedEvent).collection('signups').get().then(snapshot => {
                        studentListDiv.innerHTML = ''; // Clear the current list
                        snapshot.forEach(doc => {
                            const student = doc.data();
                            const studentLink = document.createElement('a');
                            // Pass both eventId and userId to the studentDetails.html
                            studentLink.href = `studentDetails.html?event=${selectedEvent}&userId=${doc.id}`;
                            studentLink.textContent = student.name;
                            const studentItem = document.createElement('div');
                            studentItem.appendChild(studentLink);
                            studentListDiv.appendChild(studentItem);
                        });
                    });
                }
            });

            // Trigger event change on load to populate students for the selected event
            if (eventDropdown.options.length > 0) {
                eventDropdown.dispatchEvent(new Event('change'));
            }
        });
    </script>
</body>
</html>
